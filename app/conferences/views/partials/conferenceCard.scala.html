@import conferences.models.Conference
@import common.views.html.format._
@(conference: Conference, context: String)
<div class="conference-item">
    @if(context == "public"){
        @*<a href="@conferences.controllers.routes.Application.history(conference.id)" class="close"><i class="fa fa-history"></i></a>*@
        <a href="@conferences.controllers.routes.Application.edit(conference.id)" class="close"><i class="fa fa-pencil"></i></a>
    }
    @if(context == "history"){
        <form method="POST" action="@conferences.controllers.routes.Application.doDelete(conference.id, conference.created.getMillis())" class="close"><button type="submit"><i class="fa fa-trash-o"></i></button></form>
        <a href="@conferences.controllers.routes.Application.editVersion(conference.id, conference.created.getMillis())" class="close"><i class="fa fa-pencil"></i></a>
    }
    <div class="row">
        <div class="col-md-8">
            @if(context == "public"){
                <h2><a href="@conferences.controllers.routes.Application.detail(conference.id)" class="anchor">
                    <i class="fa fa-link"></i></a> @conference.logo.map{url => <img src="@url" style="max-height: 50px;">} @conference.name
                </h2>
            }
            @if(context == "history"){
                <h2><a href="@conferences.controllers.routes.Application.detailVersion(conference.id, conference.created.getMillis())" class="anchor">
                    <i class="fa fa-link"></i></a> @conference.logo.map{url => <img src="@url" style="max-height: 50px;">} @conference.name
                </h2>
            }
            @conference.description.map { description =>
                <blockquote>
                    <p>@Html(description.replaceAll("\\n", "<br>"))</p>
                </blockquote>
            }
            @conference.cfp.map { cfp =>
                <p>
                    @if(cfp.opened){<span class="label label-success">ouvert</span>} else {<span class="label label-danger">fermé</span>}
                    <strong><a href="@cfp.siteUrl" target="_blank">Call For Paper</a></strong> :
                    fermeture le <strong>@date(cfp.end)</strong>
                </p>
            }
            @conference.tickets.map { tickets =>
                <p>
                    @if(tickets.opened && conference.end.isAfterNow()){<span class="label label-success">ouvert</span>} else {<span class="label label-danger">fermé</span>}
                    <strong>@tickets.siteUrl.map{url => <a href="@url" target="_blank">Tickets</a>}.getOrElse{Tickets}</strong> :
                    @Html(List(
                        tickets.price.map(p => s"<strong>$p</strong>"),
                        tickets.end.map(d => s"fermeture le <strong>${date(d)}</strong>")
                    ).flatten.mkString(", "))
                </p>
            }
            <div role="group">
                <a href="@conference.siteUrl" target="_blank" class="btn btn-default"><i class="fa fa-globe"></i> Site officiel</a>
                @conference.videosUrl.map{url => <a href="@url" target="_blank" class="btn btn-default"><i class="fa fa-video-camera"></i> Vidéos</a>}
                @conference.social.flatMap(_.twitter.flatMap(_.account)).map { account =>
                    <a href="https://twitter.com/@account" target="_blank" class="btn btn-default"><i class="fa fa-twitter"></i> @@@account</a>
                }
                @conference.social.flatMap(_.twitter.flatMap(_.hashtag)).map { hashtag =>
                    <a href="https://twitter.com/search?q=%23@hashtag" target="_blank" class="btn btn-default"><i class="fa fa-twitter"></i> #@hashtag</a>
                }
            </div>
        </div>
        <div class="col-md-4">
            <h4>@period(Some(conference.start), Some(conference.end))</h4>
            @conference.venue.map { venue =>
                <address>
                    @venue.name.map { name => <strong>@name</strong><br> }
                    @venue.street<br>
                    @venue.zipCode @venue.city, @venue.country
                    <a href="https://www.google.com/maps?q=@venue.name.getOrElse("") @venue.street @venue.zipCode @venue.city @venue.country" target="_blank"><i class="fa fa-map-marker" aria-hidden="true"></i></a>
                </address>
            }
            @if(conference.tags.length > 0) {
                <p>
                    @conference.tags.map { tag =>
                        <a href="@conferences.controllers.routes.Application.search(tags = Some(tag))" class="label label-primary">@tag</a>
                    }
                </p>
            }
            @conference.metrics.map { metrics =>
                <ul>
                    @metrics.attendeeCount.map { c => <li>@c personnes</li> }
                    @metrics.sessionCount.map { c => <li>@c sessions</li> }
                    @metrics.sinceYear.map { c => <li>Depuis @c</li> }
                </ul>
            }
            Posté le @datetime(conference.created)
            @conference.createdBy.filter(_.public).map { user =>
                par @user.twitter.orElse(user.siteUrl).map{url => <a href="@url" target="_blank" style="white-space: nowrap;">@user.name</a>}.getOrElse{<span style="white-space: nowrap;">@user.name</span>}
            }
        </div>
    </div>
</div>