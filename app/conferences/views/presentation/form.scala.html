@import conferences.models.Conference
@import conferences.models.PresentationId
@import conferences.models.PresentationData
@import conferences.models.Person
@import common.views.format.Format
@import common.views.html.forms._
@import conferences.views.html.partials._
@import conferences.views.html.person
@(conference: Conference, presentationForm: Form[PresentationData], persons: List[Person], tags: List[(String, Int)], rooms: List[(String, Int)])(implicit lang: Lang, flash: Flash, req: RequestHeader)
@conferences.views.html.main(if(presentationForm("id").value.getOrElse("") == "") {"Ajouter une présentation"} else {"Modifier la présentation \""+presentationForm("title").value.getOrElse("")+"\""}) {
    @header("")

    <div class="container" role="main">
        <div class="page-header">
            <h1>@if(presentationForm("id").value.getOrElse("") == "") {Ajouter une présentation à "@conference.name"} else {Modifier la présentation "@presentationForm("title").value"}</h1>
        </div>

        <div class="row">
            <div class="col-md-8">
                @helper.form(action=presentationForm("id").value.map(id => conferences.controllers.routes.Presentations.doEdit(conference.id, PresentationId(id))).getOrElse(conferences.controllers.routes.Presentations.doCreate(conference.id)), 'class->"form-horizontal presentation-form") {
                    <fieldset>
                        <legend>Présentation</legend>
                        @inputHidden(presentationForm("conferenceId"), 'value -> conference.id.unwrap)
                        @presentationForm("id").value.map { _ => @inputHidden(presentationForm("id")) }
                        @fieldHorizontal(presentationForm("title"), 'label -> "Titre *") { field => @inputText(field, 'placeholder -> "ex: Devoxx France 2016") }
                        <!-- TODO : add ajax preview of embed slides & video -->
                        @fieldHorizontal(presentationForm("videoUrl"), 'label -> "Vidéo", 'constraints -> "false") { field => @inputText(field, 'placeholder -> "ex: Devoxx France 2016") }
                        @fieldHorizontal(presentationForm("slidesUrl"), 'label -> "Slides", 'constraints -> "false") { field => @inputText(field, 'placeholder -> "ex: Devoxx France 2016") }
                        @fieldHorizontal(presentationForm("speakers"), 'label -> "Speakers") { field =>
                            @inputTagsItem(field, persons.map(p => (p.id.unwrap, Html(p.avatar.map(url => s"<img src='$url' style='height: 18px;'> ").getOrElse("")+p.name))), 'onCreate -> "createPersonModal", 'onCreateLabel -> "Nouveau speaker", 'placeholder -> "ex: John Doe")
                        }
                        @fieldHorizontal(presentationForm("tags"), 'label -> "Tags", 'constraints -> "false") { field => @inputTags(field, tags.sortBy(-_._2).map(_._1), 'placeholder -> "ex: web, java, tech") }
                        @fieldHorizontal(presentationForm("description"), 'label -> "Description", 'constraints -> "false") { field => @inputTextarea(field, 'placeholder -> "ex: La conférence pour les Développeurs Passionnés", 'rows -> "4") }
                    </fieldset>
                    <fieldset>
                        <legend>Détails</legend>
                        @fieldHorizontal(presentationForm("start"), 'label -> "Date/Heure") { field => @inputDateTime(field, 'startDate -> Format.datetime(conference.start), 'placeholder -> "ex: 21/04/2016 10:15") }
                        @fieldHorizontal(presentationForm("duration"), 'label -> "Durée (min)") { field => @inputText(field, 'type -> "number", 'placeholder -> "ex: 50") }
                        @* TODO : room autocomplete *@
                        @fieldHorizontal(presentationForm("room"), 'label -> "Salle", 'constraints -> "false") { field => @inputTypeahead(field, rooms.map(_._1), 'placeholder -> "ex: Devoxx France 2016") }
                    </fieldset>
                    <fieldset>
                        <legend>Vos infos</legend>
                        @createdByForm(presentationForm("createdBy"))
                    </fieldset>

                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="submit" class="btn btn-primary btn-lg">@if(presentationForm("id").value.getOrElse("") == "") {Ajouter la présentation} else {Modifier "@presentationForm("title").value"}</button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    @person.createModal()
    @footer()
}
